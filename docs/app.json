[{"name":"app.R","content":"#to update run in console\r\n#shinylive::export(appdir = \"app\", destdir = \"docs\")\r\n\r\n#in terminal:\r\n#git add docs\r\n#git commit -m \"Deploy updated Shiny app\"\r\n#git push\r\n\r\ninstall.packages(\"shinylive\")\r\nlibrary(shiny)\r\nlibrary(bslib)\r\n\r\nui <- fluidPage(\r\n  tags$head(\r\n    tags$style(HTML(\"\r\n      body {\r\n        background-color: #e2e9eb;\r\n      }\r\n      .input-row {\r\n        background-color: #0c234b;\r\n        color: white;\r\n        padding: 15px;\r\n        margin-bottom: 20px;\r\n        border-radius: 5px;\r\n      }\r\n      .input-row label, .input-row .control-label, .input-row .shiny-input-container {\r\n        color: white !important;\r\n      }\r\n      .output-card {\r\n        background-color: white;\r\n        padding: 20px;\r\n        margin-bottom: 20px;\r\n        box-shadow: 0 0 10px rgba(0,0,0,0.1);\r\n        border-radius: 8px;\r\n        word-wrap: break-word;\r\n        white-space: normal;\r\n      }\r\n      table {\r\n        width: 100%;\r\n        border-collapse: collapse;\r\n        text-align: left;\r\n      }\r\n      th, td {\r\n        padding: 8px;\r\n        border-bottom: 1px solid #ddd;\r\n      }\r\n      th {\r\n        background-color: #f5f7f8;\r\n        font-weight: bold;\r\n      }\r\n    \"))\r\n  ),\r\n  \r\n  tabsetPanel(\r\n    tabPanel(\"Airborne Risk Model\",\r\n             div(class = \"input-row\",\r\n                 fluidRow(\r\n                   column(4,\r\n                          selectInput(\"room\", \"Room Dimensions:\",\r\n                                      choices = c(\r\n                                        \"10×10×8 ft (22.7 m³)\" = \"V_10x10x8\",\r\n                                        \"24×40×8 ft (217.5 m³)\" = \"V_24x40x8\",\r\n                                        \"60×30×25 ft (1274.3 m³)\" = \"V_60x30x25\"\r\n                                      )\r\n                          )\r\n                   ),\r\n                   column(4,\r\n                          selectInput(\"ach\", \"Air Exchange Rate (ACH):\",\r\n                                      choices = c(3, 6, 12), selected = 3)\r\n                   ),\r\n                   column(4,\r\n                          sliderInput(\"duration_hr\", \"Exposure Duration (hours):\",\r\n                                      min = 0.5, max = 4, value = 1, step = 0.5)\r\n                   )\r\n                 ),\r\n                 actionButton(\"go1\", \"Run Model\",\r\n                              class = \"btn btn-light\", style = \"margin-top: 10px;\")\r\n             ),\r\n             \r\n             # Separate Risk Summary section\r\n             div(class = \"output-card\",\r\n                 h4(\"Risk Summary\"),\r\n                 htmlOutput(\"summary_txt\")\r\n             ),\r\n             \r\n             div(class = \"output-card\",\r\n                 h4(\"Estimated Infection Risk by Pathogen\"),\r\n                 tableOutput(\"risk_table\")\r\n             ),\r\n             \r\n             div(class = \"output-card\",\r\n                 h4(\"Model Assumptions\"),\r\n                 htmlOutput(\"assumptions_txt\")\r\n             )\r\n    ),\r\n    \r\n    tabPanel(\"Surface Risk Model (Coming Soon)\",\r\n             div(class = \"output-card\",\r\n                 h4(\"Demo 2 Placeholder\"),\r\n                 p(\"This tab will contain a surface contamination QMRA demo.\"))\r\n    )\r\n  )\r\n)\r\n\r\nserver <- function(input, output, session) {\r\n  \r\n  co_occupy_baseline <- function(q, V, ACH, t, IR, i=1) {\r\n    1 - exp(-(i * q * IR * t) / (V * ACH))\r\n  }\r\n  \r\n  observeEvent(input$go1, {\r\n    \r\n    iterations <- 10000\r\n    set.seed(103106)\r\n    \r\n    i <- 1\r\n    IR <- rnorm(iterations, mean = 0.012, sd = 0.0025)\r\n    IR <- pmax(IR, 0) * 60\r\n    \r\n    # Room volumes\r\n    V_10x10x8 <- 22.65\r\n    V_24x40x8 <- 217.47\r\n    V_60x30x25 <- 1274.25\r\n    \r\n    V <- switch(input$room,\r\n                \"V_10x10x8\" = V_10x10x8,\r\n                \"V_24x40x8\" = V_24x40x8,\r\n                \"V_60x30x25\" = V_60x30x25\r\n    )\r\n    ACH <- as.numeric(input$ach)\r\n    t <- input$duration_hr\r\n    \r\n    # Lognormal ERq\r\n    erq_function <- function(med, log10_sd) {\r\n      meanlog <- log(10) * log10(med)\r\n      sdlog   <- log(10) * log10_sd\r\n      rlnorm(n = iterations, meanlog = meanlog, sdlog = sdlog)\r\n    }\r\n    \r\n    q_H1N1  <- erq_function(med = 3,  log10_sd = 0.84)\r\n    q_covid <- erq_function(med = 46, log10_sd = 1.2)\r\n    \r\n    # Model runs\r\n    H1N1_vals  <- co_occupy_baseline(q_H1N1,  V, ACH, t, IR)\r\n    COVID_vals <- co_occupy_baseline(q_covid, V, ACH, t, IR)\r\n    \r\n    risk_table <- data.frame(\r\n      Pathogen = c(\"Influenza (H1N1)\", \"COVID-19 (SARS-CoV-2)\"),\r\n      Min = formatC(c(min(H1N1_vals), min(COVID_vals)), format=\"e\", digits=2),\r\n      Median = formatC(c(median(H1N1_vals), median(COVID_vals)), format=\"e\", digits=2),\r\n      Max = formatC(c(max(H1N1_vals), max(COVID_vals)), format=\"e\", digits=2),\r\n      Mean = formatC(c(mean(H1N1_vals), mean(COVID_vals)), format=\"e\", digits=2)\r\n    )\r\n    \r\n    output$risk_table <- renderTable(risk_table, striped = TRUE, bordered = TRUE)\r\n    \r\n    dim_ft <- switch(input$room,\r\n                     \"V_10x10x8\" = c(10, 10, 8),\r\n                     \"V_24x40x8\" = c(24, 40, 8),\r\n                     \"V_60x30x25\" = c(60, 30, 25)\r\n    )\r\n    \r\n    # Median risks\r\n    med_inf <- median(H1N1_vals)\r\n    med_cov <- median(COVID_vals)\r\n    \r\n    output$summary_txt <- renderText({\r\n      sprintf(\r\n        \"After spending <strong>%.1f hours<\/strong> in a <strong>%.0f ft × %.0f ft × %.0f ft room<\/strong> (≈ %.1f m³) shared with a contagious person under <strong>%s ACH<\/strong>, the median estimated infection risk is <strong>%.2f%%<\/strong> for Influenza (H1N1) and <strong>%.2f%%<\/strong> for COVID-19 (SARS-CoV-2).\",\r\n        t, dim_ft[1], dim_ft[2], dim_ft[3], V, ACH, med_inf*100, med_cov*100\r\n      )\r\n    })\r\n    \r\n    output$assumptions_txt <- renderUI({\r\n      HTML(\"\r\n        Infection risk calculated using the Wells-Riley equation under the following assumptions:\r\n        <ul>\r\n          <li>One contagious individual is present during the exposure period.<\/li>\r\n          <li>The room air is well-mixed (uniform quanta concentration).<\/li>\r\n          <li>Quanta generation remains constant throughout the exposure period.<\/li>\r\n          <li>Air removal is modeled solely by ventilation (based on ACH).<\/li>\r\n        <\/ul>\r\n        Room dimensions are converted from feet to cubic meters automatically.\r\n      \")\r\n    })\r\n  })\r\n}\r\n\r\nshinyApp(ui, server)\r\n","type":"text"}]
